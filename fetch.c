#include <sys/utsname.h>
#include <sys/types.h>
#include <unistd.h>
#include <pwd.h>
#include <time.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#if defined(CLOCK_BOOTTIME)
	#define UPTIME_FLAG CLOCK_BOOTTIME
#elif defined(CLOCK_UPTIME)
	#define UPTIME_FLAG CLOCK_UPTIME
#else
	#define UPTIME_FLAG CLOCK_MONOTONIC
#endif

char* getValue(char *buff, char initChar, char endChar){
	int indexInit = 0;
	while(!(buff[indexInit - 1]==initChar) )
		indexInit++;
	int indexEnd = indexInit+1;
	while(buff[indexEnd]!=endChar)
		indexEnd++;
	memcpy(buff, &buff[indexInit],indexEnd - indexInit);
	buff[indexEnd - indexInit]='\0';
	return buff;
}

int main(){
	struct utsname utsvar;
	uname(&utsvar);

	struct timespec uptime;
	clock_gettime(UPTIME_FLAG, &uptime);

	uid_t id = geteuid();
	struct passwd *pwd = getpwuid(id);
	
	char ascii_0[]=" "; char ascii_1[]=" "; 
	char ascii_2[]=" "; char ascii_3[]=" "; 
	char ascii_4[]=" "; char ascii_5[]=" "; 
	char ascii_6[]=" "; char ascii_7[]=" ";
	//char ascii_0[]="                  "; char ascii_1[]="                  "; 
	//char ascii_2[]="                  "; char ascii_3[]="                  "; 
	//char ascii_4[]="                  "; char ascii_5[]="                  "; 
	//char ascii_6[]="                  "; char ascii_7[]="                  ";
	//system("(echo -e '0;1;0;0;110;110;;;;;.face\n4;\n3;' | /usr/lib/w3m/w3mimgdisplay) &> /dev/null &");

	//char ascii_0[]="[31m       /\\         ";
	//char ascii_1[]="[31m      /  \\        ";
	//char ascii_2[]="[31m     /\\   \\       ";
	//char ascii_3[]="[31m    /  '   \\      ";
	//char ascii_4[]="[31m   /   ,,   \\     ";
	//char ascii_5[]="[31m  /   |  | -_\\    ";
	//char ascii_6[]="[31m /_-''    ''-_\\   ";
	//char ascii_7[]="                  ";
//	char ascii_0[]="[0mâ–‚â–‚â–‚â–‚[38;5;145mâ–‚[0m[38;5;145mâ–„[0m[38;5;252mâ–…â–…â–„â–ƒâ–[0mâ–‚â–‚â–‚â–‚ ";
//	char ascii_1[]="[0mâ–™â–‚â–‚[38;5;255m[48;5;252mâ•´[0m[38;5;252m[48;5;145mâ–†[7m      [27mâ–‡[0m[38;5;145m[48;5;252mâ–¼[0m[38;5;251m'[0mâ–Ÿ ";
//	char ascii_2[]="[0mâ–™â–‚[38;5;248m[48;5;252m [0m[38;5;252m[48;5;252m [0m[38;5;145m[48;5;252mâ––[0m[38;5;237m[48;5;252mâ•±[0m[38;5;252m[48;5;252m [0m[38;5;237m[48;5;252mâ•¹[0m[38;5;145m[48;5;252mâ–„[0m[38;5;145m[48;5;252mâ–„[0m[38;5;237m[48;5;252mâ”ƒ[0m[38;5;252m[48;5;252m [0m[38;5;252m[48;5;252m [0m[38;5;252mâ•¸[0mâ–Ÿ ";
//	char ascii_3[]="[0mâ–™[7m[38;5;145mâ–[0m[38;5;145m[48;5;252mu[0m[38;5;252m[48;5;252m [0m[38;5;234m[48;5;252m'[0m[38;5;233m[48;5;188mâ–[0m[38;5;233m[48;5;188mâ–[0m[38;5;233m[48;5;188m [0m[38;5;145m[48;5;145m [0m[38;5;233m[48;5;145m [0m[38;5;233m[48;5;145mâ–[0m[38;5;252m[48;5;145mâ–[0m[38;5;252m[48;5;252m [0m[38;5;236mâ–Ž[0mâ–Ÿ ";
//	char ascii_4[]="[0mâ–™[7m[38;5;253mâ–‹[0m[38;5;237m[48;5;145mâ”‚[0m[38;5;252m[48;5;252m [0m[38;5;237m[48;5;145mâ–—[0m[38;5;52m[48;5;255mâ–„[0m[38;5;233m[48;5;255mâ”€[0m[38;5;255m[48;5;255m [0m[38;5;255m[48;5;255m [0m[38;5;52m[48;5;255mâ–—[0m[38;5;16m[48;5;188mâ”€[0m[38;5;237m[48;5;145mâ”›[0m[38;5;252m[48;5;233mâ–˜[0mâ–‚â–Ÿ ";
//	char ascii_5[]="[0mâ–™â–‚[0m[7m[38;5;252mâ––[0m[38;5;145m[48;5;252mâ–†[0m[38;5;102m[48;5;255mâ–Ž[0m[38;5;205m[48;5;255m~[0m[38;5;255m[48;5;255m [0m[38;5;0m[48;5;255m_[0m[38;5;255m[48;5;255m [0m[38;5;188m[48;5;255mâ–[0m[38;5;237m[48;5;253m~[0m[38;5;145m[48;5;237m~[0m[38;5;145mâ”—[0mâ–‚â–Ÿ ";
//	char ascii_6[]="[0mâ–™[38;5;109mâ–‚[0m[38;5;95mâ–ƒ[0m[38;5;109m[48;5;16mâ–„[0m[38;5;236m[48;5;188m~[0m[38;5;181m[48;5;188mâ—¥[0m[38;5;181m[48;5;255mâ”€[0m[38;5;66m[48;5;255mâ–ƒ[0m[7m[38;5;255mâ–„[0m[7m[38;5;145mâ–‚[0m[7m[38;5;188m[27m[0mâ–‚â–‚â–‚â–‚â–Ÿ ";
//	char ascii_7[]="[0mâ–™[38;5;244m[48;5;237mâ––[0m[38;5;109m[48;5;237mâ”—[0m[38;5;95m[48;5;109mâ•²[0m[38;5;109m[48;5;109m [0m[38;5;254m[48;5;188mâ–—[0m[38;5;254m[48;5;188mâ–„[0m[38;5;109m[48;5;66mâ–„[0m[38;5;109m[48;5;66m,[0m[38;5;237m[48;5;16mâ–ƒ[0mâ–‚â–‚â–‚â–‚â–Ÿ ";

//	char ascii_0[]="[0m[38;5;219m[48;5;212mâ–ƒ[0m[38;5;212m[48;5;219mQ[0m[38;5;219m[48;5;212mZ[0m[38;5;219m[48;5;212m_[0m[38;5;211m[48;5;219m{[0m[38;5;230m[48;5;182mâ–‚[0m[38;5;181m[48;5;224mâ–€[0m[38;5;224m[48;5;230mâ–ƒ[0m[38;5;224m[48;5;230mâ–†[0m[38;5;224m[48;5;181mâ–”[0m[38;5;224m[48;5;181mâ–˜[0m[38;5;182m[48;5;224mâ–•[0m[38;5;212m[48;5;219my[0m[38;5;219m[48;5;212mz[0m[38;5;219m[48;5;212m)[0m[38;5;219m[48;5;212mâ–ƒ[0m[38;5;218m[48;5;219mâ–[0m ";
//	char ascii_1[]="[0m[38;5;183m[48;5;219mâ–€[0m[38;5;218m[48;5;219m\\[0m[38;5;212m[48;5;218mâ—†[0m[38;5;224m[48;5;181mâ–†[0m[38;5;174m[48;5;224mâ–‚[0m[38;5;181m[48;5;224mâ–ƒ[0m[38;5;181m[48;5;230mâ–¼[0m[38;5;230m[48;5;181mâ–…[0m[38;5;181m[48;5;230m`[0m[38;5;182m[48;5;230m'[0m[38;5;181m[48;5;230mâ–€[0m[38;5;223m[48;5;181mâ–‚[0m[38;5;230m[48;5;181mâ–‚[0m[38;5;224m[48;5;219mâ–[0m[38;5;218m[48;5;219mr[0m[38;5;212m[48;5;219m%[0m[38;5;212m[48;5;219m%[0m ";
//	char ascii_2[]="[0m[38;5;219m[48;5;183mâ–ƒ[0m[38;5;219m[48;5;189m\\[0m[38;5;189m[48;5;219m*[0m[38;5;217m[48;5;219mâ–”[0m[38;5;230m[48;5;187mâ–…[0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;182mâ–Š[0m[38;5;219m[48;5;219m'[0m[38;5;219m[48;5;219m [0m[38;5;219m[48;5;219m [0m[38;5;219m[48;5;219m [0m ";
//	char ascii_3[]="[0m[38;5;189m[48;5;219m\\[0m[38;5;183m[48;5;219mâ–ƒ[0m[38;5;183m[48;5;189mâ–…[0m[38;5;187m[48;5;230mâ–˜[0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;152m[48;5;230mâ–[0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;181m[48;5;230mâ–[0m[38;5;230m[48;5;230m [0m[38;5;223m[48;5;219mâ–‹[0m[38;5;219m[48;5;189mâ–ž[0m[38;5;219m[48;5;219m [0m[38;5;219m[48;5;219m [0m ";
//	char ascii_4[]="[0m[38;5;255m[48;5;219mâ–ƒ[0m[38;5;189m[48;5;219mâ–ž[0m[38;5;181m[48;5;230m][0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;249m[48;5;230mâ–—[0m[38;5;110m[48;5;152m4[0m[38;5;231m[48;5;230mâ–‚[0m[38;5;230m[48;5;231mâ–€[0m[38;5;110m[48;5;255m5[0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;230m [0m[38;5;252m[48;5;183mâ–ƒ[0m[38;5;219m[48;5;183mâ–—[0m[38;5;183m[48;5;219mâ–…[0m ";
//	char ascii_5[]="[0m[38;5;231m[48;5;231m [0m[38;5;255m[48;5;231m`[0m[38;5;181m[48;5;230mâ–•[0m[38;5;181m[48;5;230mâ–[0m[38;5;230m[48;5;230m [0m[38;5;181m[48;5;230mâ–‚[0m[38;5;230m[48;5;230m [0m[38;5;230m[48;5;167mâ–†[0m[38;5;231m[48;5;230mâ–[0m[38;5;231m[48;5;231m [0m[38;5;231m[48;5;231m [0m[38;5;252m[48;5;231mâ–ž[0m[38;5;230m[48;5;230m [0m[38;5;224m[48;5;230mâ—†[0m[38;5;224m[48;5;231mâ––[0m[38;5;231m[48;5;231m [0m[38;5;231m[48;5;219mâ–…[0m ";
//	char ascii_6[]="[0m[38;5;183m[48;5;231mâ—[0m[38;5;183m[48;5;231mâ–†[0m[38;5;183m[48;5;231mâ–…[0m[38;5;230m[48;5;183mâ–€[0m[38;5;176m[48;5;181mâ–†[0m[38;5;176m[48;5;176m [0m[38;5;176m[48;5;176m [0m[38;5;176m[48;5;181mâ–…[0m[38;5;176m[48;5;230mâ–†[0m[38;5;183m[48;5;231mz[0m[38;5;231m[48;5;238mâ–Ž[0m[38;5;238m[48;5;230mâ–…[0m[38;5;238m[48;5;230mâ–Ž[0m[38;5;187m[48;5;230mc[0m[38;5;231m[48;5;230mâ–…[0m[38;5;231m[48;5;231m [0m[38;5;255m[48;5;231mâ–[0m ";
//	char ascii_7[]="[0m[38;5;231m[48;5;231m [0m[38;5;231m[48;5;231m [0m[38;5;231m[48;5;231m [0m[38;5;231m[48;5;183mâ–†[0m[38;5;176m[48;5;183mâ–ƒ[0m[38;5;176m[48;5;183mâ–ƒ[0m[38;5;183m[48;5;176mz[0m[38;5;176m[48;5;183mâ–€[0m[38;5;176m[48;5;182mâ–€[0m[38;5;183m[48;5;244mâ–€[0m[38;5;16m[48;5;236mâ––[0m[38;5;235m[48;5;238mâ–¼[0m[38;5;230m[48;5;223mâ–ž[0m[38;5;181m[48;5;230mâ––[0m[38;5;230m[48;5;230m [0m[38;5;231m[48;5;230mâ–[0m[38;5;231m[48;5;231m [0m ";

	printf("%s[31m%s[0m@[31m%s\n", ascii_0, pwd->pw_name, utsvar.nodename);
	printf("%s[0m____________________\n", ascii_1);
	{	
		FILE *fp;
		fp = fopen("/etc/os-release", "r");
		if (fp != NULL){
			char buff[63];
			for(int i = 0; i < 20 ; i++){
				fgets(buff, 63, (FILE*)fp);
				if(strstr(buff,"PRETTY_NAME")){
					printf("%s[31mos     [0m%s\n", ascii_2, getValue(buff,'"','"'));
					break;
				}
			}	
		fclose(fp);
		} else {
			printf("%s\n", ascii_2);
		}
	}

	printf("%s[31mshell [0m %s\n", ascii_3, getenv("SHELL"));
	printf("%s[31mhost  [0m %s\n", ascii_4, utsvar.machine);
	printf("%s[31mkernel[0m %s\n", ascii_5, utsvar.release);
	printf("%s[31muptime[0m %dd %dh %dm\n", ascii_6, (int)(uptime.tv_sec/3600 / 24), (int)(uptime.tv_sec/3600 % 24), (int)(uptime.tv_sec % 3600 / 60));

	{	
		FILE *fp;
		fp = fopen("/proc/meminfo", "r");
		if (fp != NULL){
			char buff[63];
			int avail = -1;
			int total = -1;
			for(int i = 0; (avail == -1 || total == -1) && i < 20 ; i++){
				fgets(buff, 63, (FILE*)fp);
				if(strstr(buff,"MemTotal")){
					total = strtol(getValue(buff,':','k'),NULL, 10);
				}
				if(strstr(buff,"MemAvailable")){
					avail = strtol(getValue(buff,':','k'),NULL, 10);
				}
			}	
			printf("%s[31mmemory [0m%dM / %dM\n", ascii_7, (total - avail) / 1024, total / 1024);
			fclose(fp);
		}else {
			printf("\n");
		}
	}
//	printf("\n");
//	for(int i = 0; i < 8; ++i) 
//		printf("[4%dm   ", i);
//	printf("\n");
//	for(int i = 0; i < 8; ++i) 
//		printf("[10%dm   ", i);
	printf("[0m\n");

	return 0;
}
